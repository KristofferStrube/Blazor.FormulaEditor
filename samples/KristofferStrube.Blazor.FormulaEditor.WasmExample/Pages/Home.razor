@page "/"
@using KristofferStrube.Blazor.FormulaEditor.BooleanExpressions
@using KristofferStrube.Blazor.FormulaEditor.Expressions

<PageTitle>MathEditor</PageTitle>

<h1>MathEditor</h1>
<p>The following are some samples of expressions that can be edited:</p>
<MathEditor Expression="sineWave" AvailableIdentifiers=@([new Identifier("n", () => 1)]) />
<br />
<br />
<MathEditor Expression="squareWave" AvailableIdentifiers=@([new Identifier("n", () => 1)]) />
<br />
<br />
<MathEditor Expression="sawtoothWave" AvailableIdentifiers=@([new Identifier("n", () => 1)]) />
<br />
<br />
<MathEditor Expression="triangleWave" AvailableIdentifiers=@([new Identifier("n", () => 1)]) />
<br />
<br />
<p>And here are some epxressions where only parts of it can be edited:</p>
<MathEditor Expression="partiallyEditableAddition" AvailableIdentifiers=@([new Identifier("x", () => 1)]) />
<br />
<br />
<MathEditor Expression="partiallyEditableFraction" AvailableIdentifiers=@([new Identifier("x", () => 1)]) />

@code {
    private Expression sineWave = new CasesExpression()
        {
            Cases = [new() {
                Value = new NumericExpression() { Value = 1 },
                Condition = new EqualsOperator() { First = new IdentifierExpression() { Value = new Identifier("n", () => 1) }, Second = new NumericExpression() { Value = 1 } }
            }],
            Otherwise = new NumericExpression() { Value = 0 },
        };

    private Expression squareWave = new MultiplicationOperator()
        {
            First = new FractionOperator()
            {
                Numerator = new NumericExpression() { Value = 2 },
                Denominator = new MultiplicationOperator()
                {
                    First = new IdentifierExpression() { Value = new Identifier("n", () => 1) },
                    Second = new ConstantExpression() { Value = new Constant("π", Math.PI) },
                    ExplicitOperator = false
                }
            },
            Second = new SubtractionOperator()
            {
                First = new NumericExpression() { Value = 1 },
                Second = new PowerOperator()
                {
                    Value = new NumericExpression() { Value = -1, Parenthesis = true },
                    Power = new IdentifierExpression() { Value = new Identifier("n", () => 1) }
                },
                Parenthesis = true
            },
            ExplicitOperator = false
        };

    private Expression sawtoothWave = new MultiplicationOperator()
        {
            First = new PowerOperator()
            {
                Value = new NumericExpression() { Value = -1, Parenthesis = true },
                Power = new AdditionOperator()
                {
                    First = new IdentifierExpression() { Value = new Identifier("n", () => 1) },
                    Second = new NumericExpression() { Value = 1 },
                    Parenthesis = true
                }
            },
            Second = new FractionOperator()
            {
                Numerator = new NumericExpression() { Value = 2 },
                Denominator = new MultiplicationOperator()
                {
                    First = new IdentifierExpression() { Value = new Identifier("n", () => 1) },
                    Second = new ConstantExpression() { Value = new Constant("π", Math.PI) },
                    ExplicitOperator = false
                }
            },
            ExplicitOperator = false
        };

    private Expression triangleWave = new FractionOperator()
        {
            Numerator = new MultiplicationOperator()
            {
                First = new NumericExpression() { Value = 8 },
                Second = new FunctionExpression()
                {
                    Function = new Function("sin", v => Math.Sin(v)),
                    Input = new FractionOperator()
                    {
                        Numerator = new MultiplicationOperator()
                        {
                            First = new IdentifierExpression() { Value = new Identifier("n", () => 1) },
                            Second = new ConstantExpression() { Value = new Constant("π", Math.PI) },
                            ExplicitOperator = false
                        },
                        Denominator = new NumericExpression() { Value = 2 }
                    },
                    Parenthesis = false
                },
                ExplicitOperator = false
            },
            Denominator = new PowerOperator()
            {
                Value = new MultiplicationOperator()
                {
                    First = new ConstantExpression() { Value = new Constant("π", Math.PI) },
                    Second = new IdentifierExpression() { Value = new Identifier("n", () => 1) },
                    ExplicitOperator = false,
                    Parenthesis = true
                },
                Power = new NumericExpression() { Value = 2 }
            }
        };

    private Expression partiallyEditableAddition = new AdditionOperator()
        {
            First = new NumericExpression() { Value = 3, Editable = false },
            Second = null,
            Editable = false
        };

    private Expression partiallyEditableFraction = new FractionOperator()
        {
            Numerator = null,
            Denominator = new MultiplicationOperator()
            {
                First = new IdentifierExpression() { Value = new Identifier("x", () => 1), Editable = false },
                Second = new ConstantExpression() { Value = new Constant("e", Math.E), Editable = false },
                Parenthesis = true,
                Editable = false
            },
            Editable = false
        };
}